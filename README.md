# AWS SOAR: Automated Threat Detection & Response with GuardDuty & Lambda

This project demonstrates the construction of a fully serverless Security Orchestration, Automation, and Response (SOAR) pipeline within AWS. The system is designed to detect suspicious EC2 activity using **AWS GuardDuty** and trigger an automated, real-time response that both notifies administrators via **SNS** and initiates remediation with an **AWS Lambda** function.

The entire workflow, from initial detection to final mitigation, is event-driven and automated, showcasing a modern, scalable approach to cloud incident response.

---
## SOAR Pipeline Architecture

The pipeline operates on a decoupled, event-driven model, ensuring scalability and flexibility.

1.  **Detection:** AWS GuardDuty continuously analyzes data sources like CloudTrail logs, VPC Flow Logs, and DNS logs. When it detects a potential threat, it generates a "finding."
2.  **Routing:** The GuardDuty finding is sent to Amazon EventBridge, which acts as a central event bus. An EventBridge rule is configured to filter for specific findings of interest.
3.  **Response (Parallel Actions):** Upon matching a finding, EventBridge triggers two actions simultaneously:
    * **Alerting:** It sends the finding to an SNS topic, which immediately pushes a formatted email alert to security personnel.
    * **Auto-Remediation:** It invokes a Lambda function, passing the finding's details as the event payload. The Lambda function then executes a pre-defined remediation action, such as isolating the compromised EC2 instance.

<img src="./assets/Architecture Diagram.png" width="800" alt="Architecture diagram of the SOAR pipeline">
*<p align="center">Figure 1: The event-driven architecture for detection, alerting, and auto-remediation.</p>*

---
## The Incident Lifecycle: From Detection to Automated Response

The pipeline was validated end-to-end using a sample GuardDuty finding to simulate a real-world threat.

### Step 1: The Threat Detection (GuardDuty)
The test was initiated by generating a sample GuardDuty finding for `Trojan:EC2/BlackholeTraffic`. This simulates an EC2 instance communicating with a known malicious IP address, a clear indicator of compromise. The screenshot below shows the command used to generate the test event and the resulting finding in the GuardDuty console.

<img src="./assets/GaurdDuty Threat Detection.png" width="800" alt="GuardDuty console showing the threat finding and the CloudShell command to generate it">
*<p align="center">Figure 2: The "Blackhole Traffic" finding in the GuardDuty console.</p>*

### Step 2: The Automation Trigger (EventBridge)
An EventBridge rule was configured to specifically listen for GuardDuty findings. This rule is the core of the automation, connecting the detection event to the response actions. The target of this rule is the remediation Lambda function, which is invoked the moment a relevant finding is received.

<img src="./assets/EventBridge Automation.png" width="800" alt="EventBridge rule showing the Lambda function as its target">
*<p align="center">Figure 3: The EventBridge rule configured to trigger the Lambda response function.</p>*

### Step 3: The Response (SNS Alert & Lambda Remediation)
Once triggered, the pipeline executes its two response actions. First, SNS delivers a detailed email alert, providing security personnel with the instance ID, IP addresses, and recommended actions. Simultaneously, the Lambda function (not pictured) would execute its code to isolate or stop the compromised instance, containing the threat within seconds.

<img src="./assets/Security Alert.png" width="800" alt="Email inbox showing the detailed security alert from AWS Notifications">
*<p align="center">Figure 4: The immediate, detailed email alert generated by the SNS topic.</p>*

---
## ðŸš€ Skills & Technologies Demonstrated

* **Cloud Security Automation & SOAR:** Designing and implementing automated workflows for incident response.
* **AWS GuardDuty:** Threat detection and analysis of cloud security findings.
* **AWS Lambda:** Developing serverless functions for automated remediation (Python, Boto3).
* **Amazon EventBridge:** Building event-driven architectures to route and filter security events.
* **Amazon SNS:** Configuring and managing automated notification and alerting systems.
* **Serverless Architecture:** Creating scalable, cost-effective security solutions without managing servers.
* **Infrastructure as Code (IaC):** Defining security pipelines programmatically for repeatability and version control.
